seajs.use(["jQuery", "config", "favorite", "login"], function($, conf, favorite, login){    var WX = window.WX, currentEl = null;    if (!window.WX) {        WX = window.WX = {};    }    WX.reloadShoppingCart = function(data, id){        cart.reload(data, id);    };    var html = '<div id="cart-overlay" class="overlay"></div>';    html += '<div class="ui-cart-confirm"><div class="content"><p>您确定要删除吗？</p><p><button name="confirm">确定</button><button name="cancel">取消</button></p></div><div class="arrow"></div></div>';    html += '<div class="ui-cart-tip"><div class="content"><p style="text-align:center;">当前商品可用量不足！关闭后系统将自动为您调整数量</p><p style="text-align:center;"><a href="javascript:;" bind="closeTip" style="color:#1A66B4;">关闭</a></p></div><div class="arrow"></div></div>';    html += '<div id="cart-message" style="display:none;"></div>';    $(html).appendTo(document.body);    $("#cart-message").ajaxSend(function(){        $(this).html("<div class='loading'>购物车正在更新中...</div>").css({            "top": ($(window).height() / 2 + $(document).scrollTop())        }).fadeIn("slow");        if (!!this.timer)             clearTimeout(this.timer);    }).ajaxSuccess(function(){        $(this).html("<div class='success'>购物车更新成功.</div>");    }).ajaxError(function(){        $(this).html("<div class='error'>购物车更新失败.</div>");    }).ajaxComplete(function(){        var el = this;        this.timer = setTimeout(function(){            $(el).fadeOut("slow");        }, 2000);    });    function mul(n1, n2){        var m = 0, s1 = n1.toString(), s2 = n2.toString();        try {            m += s1.split(".")[1].length;        }         catch (e) {        }        try {            m += s2.split(".")[1].length;        }         catch (e) {        }        return Number(s1.replace(".", "")) * Number(s2.replace(".", "")) / Math.pow(10, m)    };    var cart = {        el: $("#cart-goods-list"),        mergeWinHtml:'<div class="widgets-window merge-window" id="mergeWin" style="display:none;"><div class="widgets-title"><span>购物车</span><a href="javascript:;" bind="close">X</a></div><div class="widgets-content"></div></div>',		isLogin:true,        resultMap: {            "1": function(){                cart.parse(cart.data);                cart.render();            },            "2": function(){                cart.notExist()            },            "3": function(){                cart.unavailable()            },            "4": function(){                cart.noLongerAvailable()            },            "5": function(){                cart.invalidNumber()            },            "7": function(){                cart.restrictNumber()            }        },        promTemplate: {            "marquee": "<div class='prom'></div>",            "20004": {                promName: "满￥{minMoney}省￥{amount}",                hasMet: "",                willBeMet: "再购买￥{needMoney}，可以省￥{moreSaveMoney}"            },            "20005": {                promName: "满￥{minMoney}送￥{amount}礼券",                hasMet: "",                willBeMet: "再购买￥{needMoney}，可赠送￥{moreSaveMoney}礼券"            },            "20006": {                promName: "满￥{minMoney}减￥{amount}运费",                hasMet: "",                willBeMet: "再购买{needMoney}，可减￥{moreSaveMoney}运费"            },			"20008":{				promName: "购买指定活动商品满￥{minMoney}省￥{amount}",                hasMet: "",                willBeMet: "再购买指定活动商品￥{needMoney}，可以省￥{moreSaveMoney}"			}        },        showMessage: function(msg){            var offset = cart.currentTarget.offset(), el = $("div.ui-cart-tip");            el.find("p:first-child").html(msg);            el.css({                "top": offset.top - cart.currentTarget.height() - el.height(),                "left": offset.left - (el.width() / 2) + cart.currentTarget.width() / 2,                "display": "block"            });        },        notExist: function(){            this.showMessage("不存在的商品");        },        unavailable: function(){            this.showMessage("商品库存数量不能满足您的要求，关闭后系统将为您自动调整");            this.needRefresh = true;        },        restrictNumber: function(){            this.showMessage("<b style='font-weight:bolder;'>该商品本次优惠限购<br/>超出部分请重新下单</b><br/>关闭后系统将为您自动调整");            this.needRefresh = true;        },        noLongerAvailable: function(){            this.showMessage("商品已下架");        },        invalidNumber: function(){            this.showMessage("错误的数量");        },        reload: function(data, id){            var callback = cart.resultMap[data.status];            cart.data = data;            cart.needRefresh = false;            callback();            if (data.status == "1") {                if (!!id) {                    cart.currentTarget = $("#" + id);                    var mess = "<b style='font-weight:bolder;'>购物车更新成功!</b><br/>共有<b class='red fb'>"                     	+ data.shoppingcart.count + "</b>件商品，价格总计：<b class='red fb'>￥"                     	+ data.shoppingcart.salePrice.toFixed(2) + "</b>";                    cart.showMessage(mess);                }            }        },        parse: function(data){            this.groupedItemList = {};            this.data = data;            if (data && data.shoppingcart && data.shoppingcart.itemList) {                $.each(data.shoppingcart.itemList, function(){                    var key = "" + this.shop.id + this.supplyTypeCode;                    if (!!cart.groupedItemList[key]) {                        cart.groupedItemList[key].push(this);                    }                    else {                        cart.groupedItemList[key] = [this];                    }                });                this.parsePromotion();            }        },        parsePromotion: function(){            this.groupedPromotion = {};            if (this.data.shoppingcart.proms) {                $.each(this.data.shoppingcart.proms, function(){                    var key = "" + this.shopId + this.supplyTypeCode;                    if (!!cart.groupedPromotion[key]) {                        cart.groupedPromotion[key].push(this);                    }                    else {                        cart.groupedPromotion[key] = [this];                    }                });            }        },        render: function(){            var shoppingcart = cart.data.shoppingcart, html = '<table class="cart_goods" width="100%" border="0" cellspacing="0" cellpadding="0"><thead><tr><th colspan="2">商品名称</th><th width="80">积分</th><th width="120">文轩价</th><th width="80">优惠</th><th width="100">数量</th><th width="80">操作</th></tr></thead><tbody>';            if (shoppingcart && shoppingcart.itemList && shoppingcart.itemList.length > 0) {                $.each(cart.groupedItemList, function(key, value){                    html += '<tr><td class="suppliers" colspan="7"><p key="' + key + '">商家： ' + value[0].shop.shopName + (value[0].supplyTypeCode == 13102 ? "&nbsp;&nbsp;<b class='red'>新品预售</b>" : "") + '</p></td></tr>';                    $.each(value, function(){                        var tag = "";                        if (this.statusCode == "13001") {                            tag = " class='out-of-stock'";                        }                        html += '<tr' + tag + '>';                        html += '<td width="70"><a class="shoppingCartHead" href="' + this.url + '" target="_blank" class="thumbnail" title="' + this.name + '"><img src="' + this.imageUrl + '" alt="' + this.name + '" class="fl"/>';						if(this.ploy){							html +='<img class="promIcon" src="http://static.winxuancdn.com/css2/images/ads/pro_icon9.png"/></a></td>';													}else{							html +='</a></td>';						}                        html += '<td><p class="ac_goods_intro"><a href="' + this.url + '" title="' + this.name + '">' + this.name + '</a>';                        html += cart.getGiftHtml(this) + '</p></td>';                        html += '<td>' + (this.points) + '</td>';                        html += '<td><b class="red fb">￥' + this.salePrice.toFixed(2) + '（' + mul(this.discount, 100) + '折）</b></td>';                        html += '<td>减' + this.savePrice.toFixed(2) + '</td>';                        html += '<td><a href="javascript:;" bind="reduceQuantity"><img src="' + conf.imgServer + '/images/reduce.gif" alt="reduce"></a><input class="quantity" name="quantity" type="text" size="3" defaultValue="' + this.quantity + '" value="' + this.quantity + '" id="' + this.productSaleId + '" onpaste="return !clipboardData.getData(\'text\').match(\/\D\/)" ondragenter="return false" style="ime-mode:Disabled"/><a href="javascript:;" bind="increaseQuantity"><img src="' + conf.imgServer + '/images/increase.gif" alt="increase"></a></td>';                        html += '<td><a class="link2" href="#" bind="addItemToFavorite" param="' + this.productSaleId + '">加入收藏</a><br/><a class="link2" href="javascript:;" bind="removeItemFromCart" param="' + this.productSaleId + '">删除</a></td>';                        html += '</tr>';                    });                });                $(".statistics_view").show();            }            else {                html += '<tr><td height="170" colspan="7">你还没有挑选商品， <a class="link2" href="http://www.winxuan.com/">去促销看看 &gt;&gt;</a></td></tr>';                $(".statistics_view").hide();            }            html += "</tbody></table>";            cart.el.html(html);            $(".salePrice_view").html("￥" + this.data.shoppingcart.salePrice.toFixed(2));            cart.checkOutOfStock();            cart.checkPromotion();        },        getGiftHtml: function(item){            var html = [];            if (item.gifts && item.gifts.length > 0) {                $.each(item.gifts, function(){                    html.push("<a class='gift' target='" + this.giftId + "' href='");                    html.push(conf.portalServer + "/product/" + this.giftId);                    html.push("'>赠:<span>");                    html.push(this.giftName);                    html.push("</span>( x " + this.sendNum);                    html.push(")</a>");                });            }            return html.join("");        },        checkPromotion: function(){            if (cart.groupedPromotion) {                $.each(cart.groupedPromotion, function(key, value){                    var html = [], shop = cart.el.find("p[key='" + key + "']");                    $.each(value, function(){                        var info = cart.getPromotionDetails(this);                        if (info && info.length > 0) {                            html.push(info);                        }                    });                    if (html.length > 0) {                        var el = $(cart.promTemplate.marquee);                        el.html(html.join("；"));                        shop.append(el);                    }                });            }        },        getPromotionDetails: function(info){            var result = [], prom, hasMet = false, html, promName;            if (info && info.promotionPrice) {                prom = info.promotionPrice;                if (prom.saveMoney > 0) {                    hasMet = true;                    html = cart.promTemplate[prom.promType].promName.replace(/\{minMoney\}/g, prom.minMoney).replace(/\{amount\}/g, prom.saveMoney), html += cart.promTemplate[prom.promType].hasMet.replace(/\{saveMoney\}/g, prom.saveMoney);                    result.push(html);                }                if (prom.needMoney > 0) {                    html = cart.promTemplate[prom.promType].willBeMet.replace(/\{needMoney\}/g, prom.needMoney.toFixed(2));                    if (hasMet) {                        html = "，" + html;                    }                    html = html.replace(/\{moreSaveMoney\}/g, prom.moreSaveMoney);                    result.push(html);                }            }            else {                return "";            }            return result.join("");        },        init: function(){            var list = cart.el, confirm = $("div.ui-cart-confirm");            this.tip = $("div.ui-cart-tip");            list.find("input[name='quantity']").live('keypress', function(e){                var b = e.which;                if (!(b >= 48 && b <= 57) || b == 44 || b == 45) {                    e.preventDefault();                }            }).live("focus", cart.changeStatus).live("blur", cart.changeQuantity);            list.find("a[bind='reduceQuantity']").live('click', cart.reduceQuantity);            list.find("a[bind='increaseQuantity']").live('click', cart.increaseQuantity);            list.find("a[bind='addItemToFavorite']").live('click', function(e){                cart.addItemToFavorite(e, this);            });            list.find("a[bind='removeItemFromCart']").live('click', cart.removeItemFromCart);            confirm.find("button[name='confirm']").click(cart.confirmRemove);            confirm.find("button[name='cancel']").click(cart.confirmCancel);            this.tip.find("a[bind='closeTip']").click(function(){                cart.hideTip();            });            this.balanceButton = $(".checkout button[bind='GotoBalance']");            this.balanceButton.click(cart.gotoBalance);            this.status = "normal";            $("a[bind='shopping']").click(cart.shopping);            $.ajax({                url: conf.portalServer + "/shoppingcart?format=json&t=" + new Date().getTime(),                success: function(data){                    cart.reload(data);                    cart.checkOutOfStock();                },                error: function(xhr, status){                    cart.el.find("td:first-child").html("<b>购物车更新失败，请<a href='javascript:window.location.reload();'>重新刷新</a>当前窗口</b>");                },                global: false,                dataType: "json"            });            var url = location.search;            if (url.indexOf("message") != -1) {                var msginfo = url.split("message=");                if (msginfo[1].indexOf("deliveryfee") > -1) {                    alert("配送地区无法到达,请选择其他配送点\n 客服:400-702-0808\n ");                }            }        },        hideTip: function(){            if (this.needRefresh) {                cart.parse(cart.data);                cart.render();            }            this.tip.hide();        },        changeQuantity: function(){            var quantity = $(this), val = cart.numberFormat(quantity);            if (quantity.val() != quantity.attr("defaultValue")) {                cart.currentTarget = quantity;                cart.currentQuantity = quantity.val();                $.getJSON(conf.portalServer + "/shoppingcart/modify?p=" + quantity.attr("id") + "&qty=" + quantity.val() + "&opt=update&format=json" + "&t=" + new Date().getTime(), function(data){                    cart.reload(data, quantity.attr("id"));                    cart.status = "normal";                });            }            else {                cart.status = "normal";            }        },        changeStatus: function(){            cart.status = "wait";        },        shopping: function(){            var url = document.referrer;            if (url.length > 0 && url.indexOf("/customer") == -1 && url.indexOf("/shoppingcart") == -1) {                window.location = url;            }            else {                window.location = "http://www.winxuan.com";            }        },        numberFormat: function(jEl){            var value = jEl.val();            if (isNaN(value)) {                value = parseInt(jEl.attr("defaultValue"));                jEl.val(jEl.attr("defaultValue"));            }            else {                value = parseInt(value);            }            return value;        },        reduceQuantity: function(e){            var quantity = $(this.parentNode).find("input[name='quantity']"), value = cart.numberFormat(quantity);            if (value == 1) {                var el = $(this.parentNode.parentNode).find("a[bind='removeItemFromCart']")[0];                cart.removeItemFromCart.call(el, [e]);            }            else {                quantity.val(value - 1);                $.getJSON(conf.portalServer + "/shoppingcart/modify?p=" + quantity.attr("id") + "&qty=" + quantity.val() + "&opt=update&format=json&t=" + new Date().getTime() + "", function(data){                    cart.reload(data, quantity.attr("id"));                });            }            cart.currentTarget = quantity;            cart.currentQuantity = quantity.val();            e.preventDefault();        },        increaseQuantity: function(e){            var quantity = $(this.parentNode).find("input[name='quantity']"), value = cart.numberFormat(quantity);            quantity.val(value + 1);            $.getJSON(conf.portalServer + "/shoppingcart/modify?p=" + quantity.attr("id") + "&qty=" + quantity.val() + "&opt=update&format=json&t=" + new Date().getTime() + "", function(data){                cart.reload(data, quantity.attr("id"));            });            cart.currentTarget = quantity;            e.preventDefault();        },        addItemToFavorite: function(e, el){            var id = $(el).attr("param");            cart.currentTarget = $("#" + id);            cart.showMessage("<b style='font-weight:bolder'>正在更新收藏，请稍候...</b>");            favorite.addFormCart(id);            e.preventDefault();        },        removeItemFromCart: function(e){            var input = $("#" + $(this).attr("param")), offset = input.offset(), el = $("div.ui-cart-confirm"), id = $(this).attr("param");            el.css({                "top": offset.top - input.height() - el.height(),                "left": offset.left - el.width() / 2 + input.width() / 2,                "display": "block"            });            el.attr("productSaleId", id);            $("div.ui-cart-tip").hide();        },		checkout:function(){			if (cart.status == "normal") {                var url = "http://" + document.domain + "/shoppingcart/select", win;                try {                    win = window.open(url, "_self");                }                 catch (e) {                    throw new Error(e.message);                }            }		},        gotoBalance: function(e){            if (cart.hasOutOfStock) {                cart.hightlight();            }			if(!cart.isLogin){				login.show({showBalance:true});				if(!cart.bindCheckout){					$(login).bind(login.LOGINED_EVENT,function(){						cart.isLogin=true;						cart.merge();					});					cart.bindCheckout=true;									}				e.preventDefault();				e.stopPropagation();				return;			}            else {                cart.checkout();            }        },        merge:function(){        	$.getJSON(conf.portalServer + "/shoppingcart/queryShoppingcart?format=jsonp&callback=?", function(data){                if(data.result>0){                	cart.showMergeWin(data);                }else{					cart.checkout();				}            });        },        showMergeWin:function(data){        	$(cart.mergeWinHtml).appendTo(document.body);        	cart.mergeWindow=$("#mergeWin");        	cart.overlay = $("div.widgets-overlay");            if (cart.overlay.length == 0) {                $('<div class="widgets-overlay"></div>').appendTo(document.body);                cart.overlay = $("div.widgets-overlay");            }            cart.renderMergeWin(data);            cart.bindMerge();            cart.locate();        },        renderMergeWin:function(data){        	cart.quantity=0;        	var html='<p class="tip"><b class="fb">温馨提示：</b>你曾经在购物车中加入过商品，是否与现在的商品合并？</p>'+        				'<p class="fb">共有<b class="red">{quantity}</b>件商品</p><div class="list"><ul class="booklist">';        	$.each(data.itemList, function(){        		html+='<li><a href="'+this.url+'" target="_blank" title="'+this.name+'" class="img">'+						'<img alt="'+this.name+'" src="'+this.imageUrl+'" class="fl"></a>'+						'<p><a href="'+this.url+'" target="_blank" title="'+this.name+'">'+this.name+'</a><br/>'+						'<b class="red fb">文轩价：￥'+this.salePrice+'</b><del>定价￥'+this.listPrice+'</del></p></li>';				cart.quantity+=this.quantity;        	});        	html+='</ul></div><p class="operate"><button bind="merge">添加至购物车</button><button bind="addFavor">不，移入收藏</button></p>';            html = html.replace(/\{quantity\}/g, cart.quantity);            cart.content = cart.mergeWindow.find("div.widgets-content");            cart.content.html(html);        },        bindMerge:function(){        	cart.mergeWindow.find(".widgets-title a").click( function(){                $.getJSON(conf.portalServer + "/shoppingcart/merge?opt=2&format=jsonp&callback=?", function(data){                  	cart.closeMergeWin();                	cart.checkout();			    });            });            cart.mergeWindow.find("button[bind='merge']").click( function(e){                $.getJSON(conf.portalServer + "/shoppingcart/merge?opt=1&format=jsonp&callback=?", function(data){			        cart.closeMergeWin();			        cart.reload(data);			    });            	e.preventDefault();            	e.stopPropagation();            });            cart.mergeWindow.find("button[bind='addFavor']").click(function(e){            	$.getJSON(conf.portalServer + "/shoppingcart/merge?opt=3&format=jsonp&callback=?", function(data){			        cart.closeMergeWin();			        cart.checkout();			    });            	e.preventDefault();            	e.stopPropagation();            });        },        closeMergeWin:function(){        	cart.overlay.hide();            cart.mergeWindow.hide();        },        locate:function(){        	cart.mergeWindow.css({                top: $(window).height() / 2 + $(document).scrollTop() - cart.mergeWindow.height() / 2,                display: "block"            });            cart.overlay.css({                height: $(document).height(),                width: $(window).width(),                display: "block"            });        },        hightlight: function(){            $("#cart-overlay").css({                "height": $(document.body).outerHeight(),                "width": $(document.body).outerWidth(),                "top": 0,                "left": 0            }).show();            this.scrollToOutOfStock();        },        scrollToOutOfStock: function(){            var el = $(".out-of-stock-overlay").first(), offset = el.offset();            window.scrollTo(offset.left, offset.top - (($(window).height() - el.height()) / 2));        },        confirmRemove: function(){            var id = $("div.ui-cart-confirm").attr("productSaleId");            $.getJSON(conf.portalServer + "/shoppingcart/modify?p=" + id + "&qty=0" + "&opt=update&format=jsonp&callback=?", function(data){                cart.reload(data);            });            $("div.ui-cart-confirm").hide();        },        confirmCancel: function(){            $("div.ui-cart-confirm").hide();        },        checkOutOfStock: function(){            $(".out-of-stock-overlay").remove();            var outOfStockList = cart.el.find("tr.out-of-stock");            if (outOfStockList && outOfStockList.length > 0) {                this.hasOutOfStock = true;                outOfStockList.each(function(i){                    var tr = $(this), el = tr.find("input[name='quantity']"), offset = tr.offset(), overlay = $("<div class='out-of-stock-overlay' name='outofstock'></div>"), html = "";                    html += "<div class='tdimage'>" + tr.find("td:eq(0)").html() + "</div>";                    html += "<div class='tdtitle'>" + tr.find("td:eq(1)").html() + "</div>";                    html += "<div class='tdtip'><div>系统提示:此商品已下架，系统将自动将此商品加入您的收藏中<button pid='" + el.attr("id") + "' bind='outOfStockRemove'>确认</button></div></div>";                    overlay.css({                        "top": offset.top,                        "height": tr.innerHeight(),                        "width": tr.innerWidth()                    });                    overlay.html(html);                    overlay.appendTo($("#cart-goods-list"));                });                cart.el.find("button[bind='outOfStockRemove']").click(cart.removeItemToFavorite);            }            else {                this.hasOutOfStock = false;                $("#cart-overlay").hide();            }        },        removeItemToFavorite: function(){            var pid = $(this).attr("pid"), handler = function(){                $.getJSON(conf.portalServer + "/shoppingcart/modify?p=" + pid + "&qty=0&t=" + new Date().getTime() + "&opt=update&format=jsonp&callback=?", function(data){                    cart.reload(data);                    $("div.ui-cart-tip").hide();                });                $(favorite).unbind(favorite.ADD_EVENT, handler);            };            $(favorite).bind(favorite.ADD_EVENT, handler);            favorite.addFormCart(pid);        }    };    cart.init();    $(favorite).bind(favorite.ADD_EVENT, function(e, data, id){        cart.currentTarget = $("#" + id);        if (!!cart.data) {            cart.showMessage("<b style='font-weight:bolder;'>此商品已成功加入您收藏夹!</b><br/>购物车中共有<b class='red fb'>" + cart.data.shoppingcart.count + "</b>件商品<br/>价格总计：<b class='red fb'>￥" + cart.data.shoppingcart.salePrice.toFixed(2) + "</b>");        }        else {            cart.showMessage("<b style='font-weight:bolder;'>此商品已成功加入您收藏夹!</b>");        }    });    $(favorite).bind(favorite.LOGIN_EVENT, function(e, data){        if (data) {            var el = cart.el.find("a[bind='addItemToFavorite'][param='" + data + "']");            login.callbackUrl = conf.portalServer + "/wxdoor.jsp?callback=miniLoginWindowCallBack";            login.show(el);            $("div.ui-cart-tip").hide();            window.miniLoginWindowCallBack = function(status, msg){                login.callback(status, msg);                try {                    el.trigger("click");                }                 catch (e) {                }            }        }    });    var el = $("#favorite");    function mul(n1, n2){        var m = 0, s1 = n1.toString(), s2 = n2.toString();        try {            m += s1.split(".")[1].length;        }         catch (e) {        }        try {            m += s2.split(".")[1].length;        }         catch (e) {        }        return Number(s1.replace(".", "")) * Number(s2.replace(".", "")) / Math.pow(10, m)    };    var view = {        htmlTemplate: '<h3 class="data_title"><a class="fr open_up" href="javascript:;"></a><a class="fr pack_up" href="javascript:;"></a>收藏的商品 <a href="http://passport.winxuan.com/login?returnUrl=http%3A%2F%2Fwww.winxuan.com%2Fshoppingcart " unit="favorite_login" style="display:none;">你还没有登录?</a></h3><div class="table-list"><div class="loading"><p>正在加载...</p></div></div>',        pageOpt: {            page: 1,            size: 5        },        login: function(el){            login.callbackUrl = conf.portalServer + "/wxdoor.jsp?callback=miniLoginWindowCallBack";            window.miniLoginWindowCallBack = function(status, msg){                login.callback(status, msg);            };            login.show(el);        },        loginTip: function(){			cart.isLogin=false;            el.find("a[unit='favorite_login']").show();            el.find(".loading p").html("你还未登录，请先<a href='javascript:;' bind='login' title='登录文轩网'>登录</a>");        },        moveItemToCart: function(pid){            if (!!pid) {                favorite.moveItemToCart(pid);            }        },        init: function(){            el.addClass("unexpand");            el.html(this.htmlTemplate);            el.find("a.open_up").click(function(e){                view.packup(e);            });            el.find("a.pack_up").click(function(e){                view.expand(e);            });            el.find("a[bind='login']").live("click", function(){                view.login(this);            });            el.find(".pages li a").live("click", function(){                var page = $(this).text();                view.pageOpt.page = page;                el.find("table").replaceWith("<div class='loading'><p class='icon'>正在加载...</p></div>");                favorite.get(view.pageOpt);            });            el.find('td a[bind="addToCart"]').live("click", function(){                cart.currentTarget = $(this);                view.moveItemToCart($(this).attr("productSaleId"));            });            el.find('td a[bind="remove"]').live("click", function(){                favorite.remove($(this).attr("productSaleId"), this);            });            el.delegate("h3.data_title", "click", function(e){                view.toggle(e)            });            $(login).bind(login.LOADED_EVENT, function(e, data){                if (!data.isLogin) {                    view.loginTip();                }            });            login.isLogin();        },        toggle: function(e){            if (el.hasClass("unexpand")) {                this.expand(e);            }            else {                this.packup(e);            }        },        load: function(data){            var html = ['<table class="order_coll">'];            if (data.favoriteList.length > 0) {                $.each(data.favoriteList, function(){                    html.push("<tr><td class='name'><a href='" + this.url + "'>" + this.name + "</a></td>");                    html.push("<td class='score'>&nbsp;</td>");                    html.push("<td class='price'><b class='red fb'>￥" + this.salePrice.toFixed(2) + "（" + mul(this.discount, 100) + "折）" + "</b></td>");                    html.push("<td class='space'>&nbsp;</td>");                    html.push("<td class='op'><a href='javascript:;' bind='addToCart' productSaleId='" + this.productSaleId + "'>添加到购物车</a><br/><a href='javascript:;' bind='remove' productSaleId='" + this.productSaleId + "'>移除</a></td>");                    html.push("</tr>");                });                html.push("</table>");                this.currentPage = data.pagination.currentPage;                this.paging(data.pagination.pageCount, html);                el.find(".table-list").html(html.join(""));            }            else {                el.find(".table-list").html("<div class='loading'><p style='color:#E05B00'>您还未收藏任何商品！</p></div>")            }            this.loaded = true;        },        paging: function(pageCount, html){            if (pageCount > 1) {                var page = ["<div class='pages'><ul>"];                for (var i = 1; i <= pageCount; i++) {                    if (this.currentPage == i) {                        page.push("<li>" + i + "</li>");                    }                    else {                        page.push("<li><a href='javascript:;'>" + i + "</a></li>");                    }                }                page.push("</ul></div>");                html.push(page.join(""));            }        },        expand: function(e){            el.removeClass("unexpand");            if (!this.loaded) {                favorite.get(this.pageOpt);            }            e.preventDefault();            e.stopPropagation();        },        packup: function(e){            el.addClass("unexpand");            e.preventDefault();            e.stopPropagation();        }    };    $(favorite).bind(favorite.REMOVE_EVENT, function(){        favorite.get({            page: 1,            size: 5        })    });    $(favorite).bind(favorite.LOAD_EVENT, function(e, data){        view.load(data);    });    $(favorite).bind(favorite.CART_EVENT, function(e, data, id){        WX.reloadShoppingCart(data, id);    });    $(favorite).bind(favorite.ADD_EVENT, function(){        favorite.get(view.pageOpt);    });    $(login).bind(login.LOGINED_EVENT, function(){        el.find("a[unit='favorite_login']").hide();        el.find("p.loading").html("<p>正在加载...</p>");        if (!el.hasClass("unexpand")) {            favorite.get(view.pageOpt);        }    });    view.init();});