define("http://static.winxuancdn.com/libs/widgets/limit.js",["jQuery","config"],function(a){function d(a){this.el=a,this.hourEl=a.find("[bind='hour']"),this.minEl=a.find("[bind='min']"),this.secEl=a.find("[bind='sec']"),this.end=parseInt(a.attr("end")),this.current=window.limitCurrentTime,isNaN(this.end)&&(this.end=(new Date).getTime()+1e7),isNaN(this.current)&&(this.current=(new Date).getTime()),this.distance=this.end-this.current,this.init()}function e(a){if(window==this)return new e(a);this.opt={},this.items=[],b.extend(this.opt,a),this.init()}var b=a("jQuery"),c=a("config");return d.prototype={init:function(){var a=this;this.timer=setTimeout(function(){a.refresh()},1e3)},refresh:function(){if(this.distance-1e3>0){this.distance=this.distance-1e3;var a=this.parse(),b=this,c=24*(a.getDate()-1);this.hourEl.html(a.getHours()+c),this.minEl.html(a.getMinutes()),this.secEl.html(a.getSeconds()),this.timer=setTimeout(function(){b.refresh()},1e3)}else{this.hourEl.html("00"),this.minEl.html("00"),this.secEl.html("00");try{this.el.remove(),this.el.trigger("reload")}catch(d){return}}},parse:function(){var a=new Date((new Date(1970,1,1,0,0,0,0)).getTime()+this.distance);return a},clearTimer:function(){clearTimeout(this.timer)}},e.prototype={init:function(){var a=this;this.limit=this.opt.context.find("[bind='limit']");if(window.limitCurrentTime)this.limit.each(function(){a.items.push(new d(b(this)))});else if(!window.currentTimeLoading)window.currentTimeLoading=!0,b.getJSON(c.portalServer+"/current.jsp?callback=?",function(c){window.limitCurrentTime=c.current,a.limit.each(function(){a.items.push(new d(b(this)))})});else var e=setInterval(function(){window.limitCurrentTime&&(a.limit.each(function(){a.items.push(new d(b(this)))}),clearInterval(e))},200);this.opt.context.bind("refresh",function(){a.refresh()}),this.opt.context.bind("reload",function(){a.reload()})},refresh:function(){var a=this;this.limit=this.opt.context.find("[bind='limit']"),b.each(this.items,function(){this.clearTimer(),a.items=null}),this.limit.each(function(){a.items=[],a.items.push(new d(b(this)))})},reload:function(){var a=this.opt.context.find("[fragment]"),c=this;a.each(function(){c.load(b(this))})},load:function(a){var d=this,e=a.attr("fragment");b.get(c.portalServer+"/fragment/"+e,function(a){var a=b(a);if(a.attr("fragment")!=e){var c=a.find("[fragment='"+e+"']");c.length>0?c.html(a.find("[fragment='"+e+"']").html()):c.html(a.filter("[fragment='"+e+"']").html())}else c.html(a.html());c.trigger("refresh")})}},e});