define("http://static.winxuancdn.com/libs/core/favorite.js",["jQuery","ui","config","cart"],function(a){var b=a("jQuery"),c=a("ui"),d=a("config"),e=a("cart"),f=d.portalServer+"/customer/favorite",g={ADD_EVENT:"add_event",ADD_ITEMS_EVENT:"add_items_event",TAG_EVENT:"tag_event",GET_EVENT:"get_event",LOAD_EVENT:"load_event",CART_EVENT:"cart_event",LOGIN_EVENT:"login_event",REMOVE_EVENT:"remove_event",REMOVE_TAG_EVENT:"remove_tag_event",ADD_TAG_EVENT:"add_tag_event",EDIT_TAG_EVENT:"edit_tag_event",REMOVE_BATCH_EVENT:"remove_batch_event",message:{1:"已成功加入收藏！",2:"此商品已收藏过，成功更新收藏时间！"},template:'<div class="favorite-result"><p>{result}</p><p><a href="http://www.winxuan.com/customer/favorite" target="myfavorite" bind="viewFavorite">查看我的收藏</a></p></div><div class="favorite-form"><p><label for="tag">自定义标签</label><input type="text" name="tag"/><span>空格隔开，最多3个标签</span></p><div><p><label for="recommend">推荐标签</label><div>{tags}</p></div><div class="button-wrap"><button bind="saveTag" p="{productSaleId}">保存标签</button></div></div>',container:'<div class="widgets-window favorite" id="favorite"><div class="widgets-title">加入收藏 <a href="javascript:;">X</a></div><div class="widgets-content"></div></div>',defOpt:{index:0,page:1,size:30},init:function(a){this.el||(b(this.container).appendTo(document.body),this.el=b("#favorite"),this.bind()),this.el.find("div.widgets-content").html("<div class='loading'><p>正在更新收藏夹，请稍候...</p></div>"),this.el.delegate("a[bind='viewFavorite']","click",function(){g.hide()}),this.el.show(),this.locate(a)},add:function(a,c){this.init(c);var d=[f+"/add?p="+a];d.push("format=jsonp"),d.push("callback=?"),b.jsonp({url:d.join("&"),success:function(a){b(g).trigger(g.ADD_EVENT,[a,c])},error:function(d,e){b(g).trigger(g.LOGIN_EVENT,[a,c])}})},addItems:function(a,c){this.init(c);var d=[f+"/add?format=jsonp"];d.push(a.join("&")),d.push("callback=?"),b.jsonp({url:d.join("&"),success:function(a){b(g).trigger(g.ADD_ITEMS_EVENT,[a,c])},error:function(d,e){b(g).trigger(g.LOGIN_EVENT,[a,c])}})},addFormCart:function(a){var c=[f+"/add?p="+a];c.push("format=jsonp"),c.push("callback=?"),b.ajax({url:c.join("&"),success:function(c){b(g).trigger(g.ADD_EVENT,[c,a])},error:function(c,d){b(g).trigger(g.LOGIN_EVENT,[a])},global:!1,dataType:"jsonp"})},tag:function(a,c){c=c.join(" ");var d=[f+"/tag?p="+a];d.push(b.param({tag:c})),d.push("format=jsonp"),d.push("callback=?"),b.ajax({url:d.join("&"),success:function(d){d.tags=c,d.pid=a,b(g).trigger(g.TAG_EVENT,[d])},dataType:"json"})},get:function(a){var c=b.extend(this.defOpt,a),d=f+"?"+b.param(c)+"&format=jsonp";b.ajax({url:d,success:function(a){b(g).trigger(g.LOAD_EVENT,[a])},error:function(a,c){a.status=="401"&&b(g).trigger(g.LOGIN_EVENT,[])},global:!1,dataType:"jsonp"})},remove:function(a,d){c.confirm({message:"您确定要移除此条数据？",dock:d,callback:function(){b.getJSON(f+"/remove?p="+a+"&callback=?",{format:"jsonp"},function(c){c.id=a,b(g).trigger(g.REMOVE_EVENT,[c])})}})},removeBatch:function(a){var d="p="+a.join("&p=");c.confirm({message:"确定删除？",callback:function(){b.ajax({type:"POST",url:f+"/removeBatch",data:d+"&_method=delete&format=json",success:function(c){c.pids=a,b(g).trigger(g.REMOVE_BATCH_EVENT,[c])}})}})},removeTag:function(a,d){c.confirm({message:"您确定要移除此条数据？",dock:d,callback:function(){b.ajax({type:"POST",url:f+"/tag",data:"tag="+a+"&_method=delete&format=json",success:function(c){c.tagId=a,b(g).trigger(g.REMOVE_TAG_EVENT,[c])}})}})},addTag:function(a,c){var a=b.trim(a);if(!a){alert("请输入标签名");return}b.ajax({type:"POST",url:f+"/tag",data:"tagName="+a+"&format=json",success:function(c){c.tagName=a,b(g).trigger(g.ADD_TAG_EVENT,[c])}})},editTag:function(a,c,d,e){var c=b.trim(c);if(!c){alert("请输入标签名");return}b.ajax({type:"POST",url:f+"/tag",data:"tagName="+c+"&tagId="+a+"&format=json&_method=put",success:function(e){e.tagId=a,e.tagName=c,e.count=d,b(g).trigger(g.EDIT_TAG_EVENT,[e])}})},moveItemToCart:function(a){e.add(a)},show:function(a,b){this.el.find("div.widgets-content").html(a),this.locate(b)},hide:function(){this.el&&this.el.length>0&&this.el.hide()},bind:function(){this.el.find(".widgets-title a").click(function(){g.hide()}),this.el.find("button[bind='saveTag']").live("click",function(){g.saveTag(this)}),this.el.find(".favorite-form a").live("click",function(){g.fillForm(this)}),this.el.find("input[name='tag']").live("focus",function(){g.showHint(this)}).live("blur",function(){g.hideHint(this)})},showHint:function(a){b(a).parent().addClass("hint")},hideHint:function(a){b(a).parent().removeClass("hint")},fillForm:function(a){var c=this.el.find("input[name='tag']");c.val().length>0?c.val(c.val()+" "+b(a).text()):c.val(b(a).text())},saveTag:function(a){var c=this.el.find("input[name='tag']").val(),d=b(a).attr("p"),e=f+"/tag?callback=?";c&&c.length>0&&b.getJSON(e,{p:d,tag:c,format:"jsonp"},function(a){b(g).trigger(g.TAG_EVENT,[a])})},locate:function(a){if(!!a){var c=b(a).offset();this.el.css({top:c.top-b(a).height()-this.el.height(),left:c.left-this.el.width()+b(a).width()})}}};return b(e).bind(e.UPDATE_EVENT,function(a,c,d){b(g).trigger(g.CART_EVENT,[c,d])}),g});